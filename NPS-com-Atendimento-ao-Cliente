{
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "id": "15cf44d5-0381-4b6c-8da2-7e16d7b40ea3",
      "name": "SerpAPI",
      "type": "@n8n/n8n-nodes-langchain.toolSerpApi",
      "position": [
        -1180,
        460
      ],
      "typeVersion": 1,
      "credentials": {
        "serpApi": {
          "id": "Itmyn4aHYneLGsoN",
          "name": "SerpAPI account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "id": "5020426e-7355-4b7b-a314-b2ab21a2da51",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        -1520,
        460
      ],
      "typeVersion": 1.2,
      "credentials": {
        "openAiApi": {
          "id": "JYlZbzi8yvevqsbt",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "eb1139cb-75f4-486c-aac8-2c30a5edaf16",
              "leftValue": "={{ $json.body.data.key.remoteJid }}",
              "rightValue": "@g.us",
              "operator": {
                "type": "string",
                "operation": "endsWith"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1460,
        -820
      ],
      "id": "295f4915-7ce5-4b37-88ac-be02e56f03cf",
      "name": "If (Verifica Contato)"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "869dd0cc-d362-464c-9e82-0e137bee5fd5",
              "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            },
            {
              "id": "0d8f2ba9-7696-4080-b0e3-7f123dbe3452",
              "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
              "rightValue": 10,
              "operator": {
                "type": "number",
                "operation": "lte"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1700,
        -280
      ],
      "id": "edba9bc3-f8a8-48ce-97bb-3091f2ec7dd5",
      "name": "If (Mensagem ou Nota)",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1640,
        240
      ],
      "id": "15719766-638e-468e-aa58-ba0886483e5a",
      "name": "Conversa"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f82892ad-1b1e-4a11-b168-3869b530c196",
              "leftValue": "={{ $json.ClienteEncontrado }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -820,
        -800
      ],
      "id": "9f58ae2b-6c38-4187-9e74-56e1948c4a28",
      "name": "Verificar se o cliente esta no banco de dados"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT TOP 1 -- Adicionei TOP 1 para garantir que ele traga apenas a OS mais recente para este cliente\n    OS.Ordem AS OSsistema,\n    C.Nome AS NomeCliente, -- Nome do Cliente\n    ISNULL(NULLIF(C.Fone1, ''), C.Fone2) AS TelefoneCliente, -- Telefone do Cliente\n    OS.DataFechamento, -- Adicionei novamente para que voc√™ possa usar, se precisar\n    OS.Observa√ß√µesFechamento AS ServicoRealizado -- Adicionei para pegar o servi√ßo realizado\nFROM\n    OSs OS\nJOIN\n    Clientes C ON C.CodCliente = OS.Cliente\nWHERE\n    OS.Status = 'B' -- Mant√©m o filtro de status da OS (Fechada, por exemplo)\n    AND OS.DataFechamento IS NOT NULL\n    AND OS.N8Nstatus IN (0, 2)\n    -- *** AQUI EST√Å A ADI√á√ÉO CRUCIAL ***\n    AND (C.Fone1 = '{ { $json.telefoneClienteLimpo } }' OR C.Fone2 = '{ { $json.telefoneClienteLimpo } }')\nORDER BY\n    OS.DataFechamento DESC, -- Ordem decrescente pela data e ordem para pegar a mais recente\n    OS.Ordem DESC;"
      },
      "type": "n8n-nodes-base.microsoftSql",
      "typeVersion": 1.1,
      "position": [
        -580,
        -820
      ],
      "id": "57cc58cf-ac7b-43e9-82a8-03f8d86464db",
      "name": "Microsoft SQL1",
      "credentials": {
        "microsoftSql": {
          "id": "pNBSzthhOjrzeBje",
          "name": "Microsoft SQL account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// SUBSTITUA TODO O CONTE√öDO DO SEU N√ì 'CODE' POR ESTE C√ìDIGO:\n\nconst outputItems = [];\nconst inputData = $input.all(); // Pega todos os itens de entrada de forma robusta\n\nfor (const item of inputData) {\n    let telefoneBruto = '';\n\n    // Tenta ler o remoteJid de v√°rios caminhos comuns, priorizando a estrutura padr√£o do n8n (item.json)\n    if (item.json) {\n        telefoneBruto = item.json.body?.data?.key?.remoteJid ||\n                        item.json.data?.key?.remoteJid || // Caminho sem 'body'\n                        item.json.key?.remoteJid ||       // Caminho sem 'data'\n                        item.json.remoteJid ||            // Caminho direto\n                        ''; // Valor padr√£o vazio se n√£o encontrar\n    } else {\n        // Se item.json N√ÉO existe, assume que 'item' √â o payload JSON bruto\n        telefoneBruto = item.body?.data?.key?.remoteJid ||\n                        item.data?.key?.remoteJid ||\n                        item.key?.remoteJid ||\n                        item.remoteJid ||\n                        ''; // Valor padr√£o vazio se n√£o encontrar\n    }\n\n    let telefoneLimpo = '';\n    if (telefoneBruto) {\n        telefoneLimpo = telefoneBruto.replace(/[^0-9]/g, ''); // Remove tudo que n√£o for d√≠gito\n    }\n\n    // --- AGORA, CONSTRU√çMOS A QUERY SQL COMPLETA AQUI MESMO ---\n    // CORRE√á√ÉO AQUI: REMOVIDAS AS TAGS HTML E BARRAS INVERTIDAS EXTRAS\n    const sqlQueryVerificacaoCliente = `\n        SELECT COUNT(C.CodCliente) AS ClienteEncontrado\n        FROM Clientes C (NOLOCK)\n        WHERE (C.Fone1 = '${telefoneLimpo}' OR C.Fone2 = '${telefoneLimpo}');\n    `;\n\n    // Adiciona a query SQL completa e pronta para execu√ß√£o ao item.\n    // O pr√≥ximo n√≥ SQL vai apenas pegar essa string e executar.\n    if (item.json) {\n        item.json.sqlQueryClienteVerificacao = sqlQueryVerificacaoCliente;\n        // Mant√©m o telefone limpo no item.json para uso posterior\n        item.json.telefoneClienteLimpo = telefoneLimpo;\n    } else {\n        item.sqlQueryClienteVerificacao = sqlQueryVerificacaoCliente;\n        // Mant√©m o telefone limpo no item para uso posterior\n        item.telefoneClienteLimpo = telefoneLimpo;\n    }\n\n    outputItems.push(item);\n}\n\nreturn outputItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1220,
        -780
      ],
      "id": "8064037b-8b50-456c-81f3-ef6c62bfd070",
      "name": "Code"
    },
    {
      "parameters": {
        "sendTo": "sistemas@ramosgrupo.com.br",
        "subject": "=Relat√≥rio de Avalia√ß√£o Negativa - Ordem de Servi√ßo: {{ $('Dados').item.json.os }}",
        "message": "=<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n    <meta charset=\"utf-8\">\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n        <title>Ordem de Servi√ßo - CearaGPS</title>\n        <meta name=\"description\" content=\"\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        <link rel=\"stylesheet\" href=\"\">\n    <title>Ordem de Servi√ßo - CearaGPS</title>\n    </head>\n    <style>\n        body {\n            background: #fff3ea;\n            font-family: 'Segoe UI', Arial, sans-serif;\n            color: #01335B;\n        }\n        .container {\n            max-width: 540px;\n            margin: 38px auto;\n            background: #fff;\n            border-radius: 18px;\n            box-shadow: 0 6px 26px rgba(243, 112, 33, 0.07);\n            padding: 38px 32px 18px 32px;\n            border: 2px solid #F37021;\n        }\n        .logo-cearagps {\n            display: block;\n            margin: 0 auto 26px auto;\n            max-width: 190px;\n        }\n        h1 {\n            font-size: 1.65rem;\n            color: #007bc1;\n            text-align: center;\n            margin-bottom: 20px; /* Ajustado o margin-bottom pois o subt√≠tulo foi removido */\n            font-weight: 700;\n            letter-spacing: -0.5px;\n        }\n        /* O subt√≠tulo foi removido, ent√£o a classe .subtitle pode ser removida ou comentada se n√£o for mais usada\n        .subtitle {\n            text-align: center;\n            color: #007bc1;\n            font-size: 1.13rem;\n            margin-bottom: 20px;\n            font-weight: 500;\n        }\n        */\n        .details {\n            background: #fff7f1;\n            border: 2px solid #F37021;\n            border-radius: 25px;\n            padding: 20px 18px 13px 18px;\n            margin-bottom: 16px;\n        }\n        .details-row {\n            display: flex;\n            justify-content: flex-start;\n            align-items: center;\n            margin-bottom: 15px;\n        }\n        .details-row strong {\n            min-width: 130px; /* Ajustado para acomodar textos maiores como \"Ordem de servi√ßo:\" */\n            color: #007bc1;\n            font-weight: 600;\n            font-size: 1.04rem;\n            text-align: left;\n        }\n        .details-row .value {\n            color: #01335B;\n            font-size: 1.03rem;\n            font-weight: 500;\n        }\n        .highlight { /* Usado para a Nota */\n            color: #F37021;\n            font-weight: bold;\n            font-size: 1.18rem;\n        }\n        /* A classe .status-chip n√£o √© mais necess√°ria para os novos campos, pode ser removida ou comentada\n        .status-chip {\n            display: inline-flex;\n            align-items: center;\n            background: #fff3ea;\n            color: #F37021;\n            border-radius: 16px;\n            font-weight: 700;\n            font-size: 1.00rem;\n            padding: 4px 15px;\n            border: 1.5px solid #F37021;\n            margin-left: 6px;\n        }\n        .status-chip svg {\n            width: 16px;\n            height: 16px;\n            margin-right: 7px;\n            color: #F37021;\n        }\n        */\n        .footer {\n            margin-top: 18px;\n            text-align: center;\n            font-size: 1.20rem;\n            color: #839bb3;\n        }\n        .footer strong {\n            color: #F37021;\n        }\n        @media (max-width: 650px) {\n            .container { padding: 15px 3vw 6px 3vw; }\n            .logo-cearagps { max-width: 120px; }\n            .details-row strong { min-width: 110px; font-size: .96rem; } /* Ajustado para responsividade */\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <img class=\"logo-cearagps\" src=\"https://cearagps.com.br/wp-content/uploads/2022/10/logo_cearagps.png\" alt=\"Logo CearaGPS\">\n        <h1>Detalhes da Ordem de Servi√ßo</h1>\n        <div class=\"details\">\n            <div class=\"details-row\">\n                <strong>Ordem de Servi√ßo:</strong>\n                <span class=\"value\">{{ $('Dados').item.json.os }}</span>\n            </div>\n            <div class=\"details-row\">\n                <strong>Nome do cliente:</strong>\n                <span class=\"value\">{{ $('Dados').item.json['Nome '] }}</span>\n            </div>\n            <div class=\"details-row\">\n                <strong>Nota:</strong>\n                <span class=\"highlight\">{{ $('Dados').item.json.Nota }}</span>\n            </div>\n        <br>\n         <div>\n            <p style=\"margin: bottom 8px;\">Este √© um resumo dos detalhes da ordem de servi√ßo e da valia√ß√£o do cliente.</p>\n        </div>\n        <div class=\"footer\">\n            Atenciosamente,<br>\n            <strong>Setor de TI CearaGPS</strong>\n        </div>\n    </div>\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -580,
        -480
      ],
      "id": "836a2fdb-bbf3-474f-8dc4-fa2c5af753ea",
      "name": "Enviar email (nota baixa)",
      "webhookId": "483d615d-ba69-4218-9bd3-bb2de1f9b7c0",
      "credentials": {
        "gmailOAuth2": {
          "id": "5Ulh1D7zAK9TBzlD",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6a12b365-4132-4017-bc2f-e872ff9af0d7",
              "leftValue": "={{ $json.Nota }}",
              "rightValue": 9,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1180,
        -120
      ],
      "id": "54b6afed-8898-4f81-8145-00372b6567d5",
      "name": "IF - Nota √ìtima (9-10)"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6a12b365-4132-4017-bc2f-e872ff9af0d7",
              "leftValue": "={{ $json.Nota }}",
              "rightValue": 4,
              "operator": {
                "type": "number",
                "operation": "lte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1180,
        -460
      ],
      "id": "bfa480a2-87eb-40d6-aa5a-0c62792828a6",
      "name": "IF - Nota Ruim (1-4)"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6a12b365-4132-4017-bc2f-e872ff9af0d7",
              "leftValue": "={{ $json.Nota }}",
              "rightValue": 5,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            },
            {
              "id": "fdc9d754-8178-425f-aa3c-31394b1f9f02",
              "leftValue": "={{ $json.Nota }}",
              "rightValue": 8,
              "operator": {
                "type": "number",
                "operation": "lte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1180,
        -300
      ],
      "id": "5a33c507-7152-42ba-ae52-9898f3815fad",
      "name": "IF - Nota M√©dia (5-8)"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Dados').item.json['Instancia '] }}",
        "remoteJid": "={{ $('Code').item.json.telefoneClienteLimpo }}",
        "messageText": "=Muito obrigado pelo seu Feedback, fez valer a pena o nosso esfor√ßo em sermos cada vez melhores. Pensando na sua experi√™ncia, indique um amigo para conhecer os nossos servi√ßos e avalie a nossa empresa no Google.\"\nGoogle: https://g.co/kgs/6toHpnr",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        -960,
        -140
      ],
      "id": "b1b863e8-3ec2-4894-92f8-3364873c5963",
      "name": "Evolution API8",
      "credentials": {
        "evolutionApi": {
          "id": "GiAYG7WVfZusxjWC",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Dados').item.json['Instancia '] }}",
        "remoteJid": "={{ $('Code').item.json.telefoneClienteLimpo }}",
        "messageText": "=Recebemos sua avalia√ß√£o de Nota {{ $('Dados').item.json.Nota }}. Agradecemos muito seu feedback, pois ele √© fundamental para aprimorarmos nossos servi√ßos. Vamos dar nosso melhor para que nossa nota seja 10",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        -960,
        -320
      ],
      "id": "acc1796f-e35a-40e0-9048-2f760accbb0c",
      "name": "Evolution API7",
      "credentials": {
        "evolutionApi": {
          "id": "GiAYG7WVfZusxjWC",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Dados').item.json['Instancia '] }}",
        "remoteJid": "={{ $('Code').item.json.telefoneClienteLimpo }}",
        "messageText": "=Sentimos muito pela sua experi√™ncia. Gostar√≠amos de entender o que aconteceu.üòï Nossa equipe entrar√° em contato para entender melhor a situa√ß√£o.",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        -960,
        -480
      ],
      "id": "e52080c2-18a1-4533-9ec8-f5947a642a13",
      "name": "Evolution API6",
      "credentials": {
        "evolutionApi": {
          "id": "GiAYG7WVfZusxjWC",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "{{ $json.sqlQueryClienteVerificacao }}"
      },
      "type": "n8n-nodes-base.microsoftSql",
      "typeVersion": 1.1,
      "position": [
        -1020,
        -780
      ],
      "id": "d669714d-3357-4eb6-b86b-8f7ac63ed63a",
      "name": "Microsoft SQL",
      "credentials": {
        "microsoftSql": {
          "id": "pNBSzthhOjrzeBje",
          "name": "Microsoft SQL account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "19e0d62d-d7fc-40f5-8ab7-f8175b015329",
              "name": "Nome ",
              "value": "={{ $json.NomeCliente }}",
              "type": "string"
            },
            {
              "id": "6a9a5a13-bbdb-442c-9af5-bcc06c1af75d",
              "name": "Numero",
              "value": "={{ $json.TelefoneCliente }}",
              "type": "string"
            },
            {
              "id": "161bdb2c-901e-48da-a19b-a97074c8058c",
              "name": "Nota",
              "value": "={{ $('Webhook').item.json.body.data.message.conversation }}",
              "type": "number"
            },
            {
              "id": "e1eac6dd-d9cd-4e0b-9696-9ec3932c6f3b",
              "name": "Instancia ",
              "value": "={{ $('Webhook').item.json.body.instance }}",
              "type": "string"
            },
            {
              "id": "8c18812a-a120-4596-b382-ff7513219e3f",
              "name": "id da mensagem",
              "value": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
              "type": "string"
            },
            {
              "id": "1bbd9a15-953c-4a8f-9c9b-1744f7f565aa",
              "name": "os",
              "value": "={{ $json.OSsistema }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1460,
        -300
      ],
      "id": "14084daa-a8b1-47ab-ad36-90175f1af5e1",
      "name": "Dados",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "showdaia",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1680,
        -820
      ],
      "id": "a7da807e-45e9-4051-9a22-7351f339c6f0",
      "name": "Webhook",
      "webhookId": "e5509289-f619-4353-8c32-17b80fcc7906"
    },
    {
      "parameters": {
        "content": "## 1. Recebimento da nota e verifica√ß√£o do cliente no banco de dados",
        "height": 340,
        "width": 1380,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1720,
        -940
      ],
      "id": "b44dbf47-a6ef-4315-b6f5-da24ae2bddf8",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## 2. Verifica√ß√£o da nota, envio de mensagem e atualiza√ß√£o de planilha com o feedback",
        "height": 580,
        "width": 1380
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1720,
        -560
      ],
      "typeVersion": 1,
      "id": "a8e79821-71fc-40cf-9b47-c5dff93b7149",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## 3. Agente IA para tratar do cliente",
        "height": 620,
        "width": 2080,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1720,
        60
      ],
      "typeVersion": 1,
      "id": "7623cbe4-15aa-4716-b82c-9d931856a882",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Webhook').item.json.body.data.key.remoteJid }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -1360,
        460
      ],
      "id": "cfb6bdce-182d-4fee-802a-193fd7637979",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.elevenlabs.io/v1/text-to-speech/UgBBYS2sOqTuMpoF3BR0",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "output_format",
              "value": "mp3_44100_128"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "xi-api-key",
              "value": "=sk_cb397d1d550bc230d9df66377184fd651c3c4e40f6066ec8"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "text",
              "value": "={{ $('Loop Over Items').item.json.text.replaceAll('**', '*') }}"
            },
            {
              "name": "model_id",
              "value": "eleven_multilingual_v2"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -260,
        420
      ],
      "id": "f6e5c149-f16d-4d96-b566-c7630fbeb223",
      "name": "Eleven Labs1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.randomNumber }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "114bca16-4241-43b4-9017-7f1e791a2b16",
                    "leftValue": "={{ $json.randomNumber }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b274180e-e92f-4562-8d5e-b8bd3dccb55b",
                    "leftValue": "={{ $json.randomNumber }}",
                    "rightValue": 3,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5ff762af-4df5-4cc3-a8b5-ee10b3bed4b6",
                    "leftValue": "={{ $json.randomNumber }}",
                    "rightValue": 4,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -180,
        140
      ],
      "id": "0c271b1d-9975-41b4-a8a4-27ca72303bd0",
      "name": "Switch1"
    },
    {
      "parameters": {
        "operation": "binaryToPropery",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -60,
        420
      ],
      "id": "e681eaf7-adf5-4a2a-a950-1b7ade6d7869",
      "name": "Extract from File1"
    },
    {
      "parameters": {
        "jsCode": "function generateRandomNumber() {\n    return Math.floor(Math.random() * 4) + 1;\n}\n\nreturn [{ json: { randomNumber: generateRandomNumber() } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -600,
        340
      ],
      "id": "ffc24fdb-854a-4fa5-9ef3-12c49f92347a",
      "name": "N√∫mero Aleat√≥rio1"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "=TesteVi",
        "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Loop Over Items').item.json.text }}",
        "options_message": {
          "delay": 5000
        }
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        140,
        120
      ],
      "id": "a2770780-e934-4fb4-8990-9f1a5edcfeb3",
      "name": "Evolution API2",
      "credentials": {
        "evolutionApi": {
          "id": "GiAYG7WVfZusxjWC",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "operation": "send-audio",
        "instanceName": "=TesteVi",
        "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
        "media": "={{ $json.data }}",
        "options_message": {
          "delay": 5000
        }
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        140,
        420
      ],
      "id": "f9022e40-f4ea-4472-bdb4-f442470025db",
      "name": "Evolution API3",
      "credentials": {
        "evolutionApi": {
          "id": "GiAYG7WVfZusxjWC",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -800,
        240
      ],
      "id": "a45881ec-3c27-4d7c-b9a4-38d22685e3df",
      "name": "Loop Over Items"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -600,
        120
      ],
      "id": "bf05cb4a-f2bb-4a42-b8e7-0d5c93492dd3",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {
        "jsCode": "/**\n * Divide o texto de cada item em frases individuais e as agrupa em mensagens de at√© 3 frases,\n * ignorando n√∫meros e URLs como delimitadores.\n * Cada grupo de frases √© retornado como um novo item em um array.\n *\n * @param {Array<Object>} items - Um array de objetos, onde cada objeto pode ter um campo 'json.output' contendo o texto a ser dividido.\n * @returns {Array<Object>} Um array de objetos, onde cada objeto cont√©m um grupo de frases no campo 'json.text',\n * ou um erro se o campo 'output' estiver ausente.\n */\nfunction splitTextSafely(items) {\n    const result = [];\n\n    items.forEach(item => {\n        // Acessa o campo 'output' dinamicamente, ou uma string vazia se n√£o existir.\n        const text = item.json?.output || '';\n\n        // Se o texto estiver vazio, adiciona um objeto de erro ao resultado.\n        if (!text) {\n            result.push({ json: { error: \"No output field provided in input.\" } });\n            return; // Pula para o pr√≥ximo item\n        }\n\n        // Express√£o regular para corresponder a delimitadores de frase v√°lidos\n        // enquanto ignora n√∫meros e URLs.\n        // - `(?<!\\d)`: N√£o precede um d√≠gito (evita dividir n√∫meros como \"1.2\").\n        // - `(?<=[.!?])`: Precede um ponto final, ponto de interroga√ß√£o ou exclama√ß√£o.\n        // - `\\s+`: Seguido por um ou mais espa√ßos em branco.\n        // - `(?!\\d)`: N√£o seguido por um d√≠gito (evita dividir URLs ou n√∫meros de vers√£o).\n        // - `|`: OU\n        // - `\\s+(?=https?:\\/\\/)`: Espa√ßos em branco seguidos por \"http://\" ou \"https://\" (para manter URLs intactas).\n        const regex = /(?<!\\d)(?<=[.!?])\\s+(?!\\d)|\\s+(?=https?:\\/\\/)/g;\n\n        // Divide o texto com base na express√£o regular, remove espa√ßos em branco extras\n        // e filtra quaisquer strings vazias resultantes.\n        const sentences = text.split(regex).map(sentence => sentence.trim()).filter(Boolean);\n\n        // Agrupa as frases em mensagens de at√© 3\n        for (let i = 0; i < sentences.length; i += 3) {\n            // Pega um grupo de at√© 3 frases\n            const chunk = sentences.slice(i, i + 3);\n            // Junta as frases do grupo com um espa√ßo\n            const combinedSentence = chunk.join(' ');\n            // Adiciona o grupo combinado ao resultado\n            result.push({ json: { text: combinedSentence } });\n        }\n    });\n\n    return result;\n}\n\n// Executa a fun√ß√£o com a entrada din√¢mica de um n√≥ anterior (assumindo que 'items' √© fornecido).\n// Esta linha seria usada em um ambiente onde a fun√ß√£o √© executada e seu retorno √© o resultado final.\nreturn splitTextSafely(items);\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1060,
        240
      ],
      "id": "bc72199d-810a-4362-992b-6134a8eba894",
      "name": "Dividir saidas1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Webhook').item.json.body.data.message.conversation }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Prompt para Assistente Virtual Z√© da Rota (CearaGPS):\n\"Voc√™ √© o Z√© da Rota, o assistente virtual especialista da CearaGPS (www.cearagps.com.br). Sua principal miss√£o √© tirar d√∫vidas sobre a empresa, nossos planos de rastreamento e prote√ß√£o veicular, e outras informa√ß√µes relacionadas ao nosso ramo de atua√ß√£o, com o objetivo final de qualificar leads e conduzir o cliente at√© a etapa de fechamento de contrato com um consultor humano.\n\nPersona e Tom de Voz:\nAja como um especialista em vendas de seguran√ßa automotiva, sendo o MAIS HUMANO POSS√çVEL em suas intera√ß√µes, mas mantendo profissionalismo e cordialidade. Evite ser rob√≥tico. Sua comunica√ß√£o deve ser clara, amig√°vel, direta, assertiva e eficiente. Seu objetivo √© deixar o cliente ciente de todos os benef√≠cios e pontos fortes da Cear√°GPS, superar obje√ß√µes com t√°ticas de venda e prepar√°-lo para o fechamento.\n\nSobre a CearaGPS e Grupo Ramos (Contexto para suas conversas):\n\nA CearaGPS foi fundada em 2012 por Euram Ramos, nosso presidente, ap√≥s ele mesmo ser v√≠tima de um roubo de ve√≠culo. Esse evento intensificou seu desejo de ajudar o pr√≥ximo e combater a criminalidade.\nA empresa come√ßou na garagem da casa dos pais dele e hoje √© refer√™ncia no Brasil em rastreamento e prote√ß√£o veicular.\nO sucesso levou √† cria√ß√£o da CRX Brasil (h√° mais de 10 anos oferecendo solu√ß√µes para empres√°rios do ramo, top 05 no Brasil) e, mais recentemente, da Resolve Prote√ß√£o Veicular. O grupo tamb√©m foi pioneiro em mentorias e imers√µes educacionais em mais de 18 estados.\nInforma√ß√µes da Empresa (para consulta e fornecimento ao cliente):\n\nContato Principal: Central de Atendimento 24h: 0800 606 8153 ou (85) 3484.6006\nHor√°rios de funcionamento presencial:\nSegunda a quinta: 08:00 √†s 20:00\nSexta-feira: 08:00 √†s 19:00\nS√°bado: 08:00 √†s 16:00\nD√∫vidas ou sugest√µes (e-mail): contato@cearagps.com.br\nFinanceiro (e-mail e WhatsApp): financeiro@cearagps.com.br | (85) 98208.2489\nWhatsApp Geral: (85) 98208.2489\nEndere√ßo: R. A, N¬∫ 981 ‚Äì Parque Dois Irm√£os, Fortaleza ‚Äì CE, 60540-256\nSua Miss√£o Detalhada:\n\nAuxiliar clientes na escolha do plano adequado para rastreamento e prote√ß√£o veicular.\nInteragir com ferramentas de API (n8n) para consultar a Placa FIPE, trazendo apenas os planos compat√≠veis com o ve√≠culo informado.\nPromover um atendimento √°gil, direto e eficiente.\nEncaminhar clientes interessados para um consultor humano quando necess√°rio.\nüõ†Ô∏è REGRAS ESSENCIAIS DE ATENDIMENTO:\n\n1Ô∏è‚É£ Consulta da Placa FIPE e Retorno de Planos:\n\nSEMPRE que o cliente informar a placa do ve√≠culo, voc√™ deve acionar o fluxo do n8n para consulta FIPE.\nRetorne APENAS os planos compat√≠veis com base em:\n‚úÖ Valor do bem (para definir a cobertura do plano de prote√ß√£o)\n‚úÖ Tipo de ve√≠culo (Carro ou Moto)\n‚úÖ Planos adequados para aquele ve√≠culo espec√≠fico.\nExemplo:\nüë§ Cliente: \"Quais planos voc√™s t√™m para meu carro?\"\nü§ñ Z√© da Rota: \"Posso verificar os planos ideais para o seu ve√≠culo! Para isso, me informe a placa do carro, por favor. üîç\"\n(Ap√≥s consulta FIPE via n8n, retorne apenas planos compat√≠veis)\nSe a consulta n√£o for poss√≠vel ou o cliente n√£o quiser informar a placa, pergunte:\n‚ùì \"Tudo bem! Voc√™ pode me dizer o modelo e ano do seu ve√≠culo? Assim, consigo te apresentar os planos mais adequados.\"\n2Ô∏è‚É£ Estrutura de Respostas:\n\n‚úÖ Seja direto, amig√°vel e objetivo. Evite textos longos ou excessivamente t√©cnicos.\n‚úÖ Use emojis moderadamente (üöóüîçüì≤) para tornar a conversa mais leve.\n‚úÖ Sempre busque capturar a inten√ß√£o do cliente antes de apresentar planos.\n‚úÖ Sempre responda com uma pergunta para manter o cliente engajado e a conversa fluindo.\n‚úÖ Caso o cliente traga um assunto fora do escopo (ex: seguro tradicional), redirecione a conversa para rastreamento e prote√ß√£o veicular.\nExemplo:\nüë§ Cliente: \"Voc√™s fazem seguro tamb√©m?\"\nü§ñ Z√© da Rota: \"N√≥s somos especialistas em rastreamento e prote√ß√£o contra roubo e furto! Nosso servi√ßo inclui rastreamento 24h e at√© 100% de cobertura da Tabela FIPE. Posso verificar os planos ideais para o seu ve√≠culo?\"\n3Ô∏è‚É£ Planos e Benef√≠cios da Cear√° GPS (Apresente SOMENTE os compat√≠veis ap√≥s consulta FIPE):\n\nüìå **Planos para Motos** (V√°lido para residentes de Fortaleza, Caucaia, Eus√©bio, Maracana√∫, Aquiraz, Itaitinga, Pacatuba e Maranguape):\n* Rastreamento + Prote√ß√£o Veicular (Cobertura 10 MIL) ‚Äì R$ 85,00/m√™s\n* Rastreamento + Prote√ß√£o Veicular (Cobertura 20 MIL) ‚Äì R$ 105,00/m√™s\n* Rastreamento + Prote√ß√£o Veicular (Cobertura 30 MIL) ‚Äì R$ 120,00/m√™s\n* Instala√ß√£o: R$ 200,00\n\nüìå **Planos para Carros** (V√°lido para residentes de Fortaleza, Caucaia, Eus√©bio, Maracana√∫, Aquiraz, Itaitinga, Pacatuba e Maranguape):\n* Rastreamento + Prote√ß√£o Veicular (Cobertura 30 MIL) ‚Äì R$ 130,00/m√™s\n* Rastreamento + Prote√ß√£o Veicular (Cobertura 40 MIL) ‚Äì R$ 150,00/m√™s\n* Rastreamento + Prote√ß√£o Veicular (Cobertura 60 MIL) ‚Äì R$ 179,90/m√™s\n* Instala√ß√£o: R$ 200,00\n\nüõ°Ô∏è **Diferenciais da Cear√°GPS (Destaque-os!):**\n* ‚úî Monitoramento 24h em tempo real\n* ‚úî Acesso via aplicativo (Android & iOS)\n* ‚úî Bloqueio remoto do ve√≠culo (abaixo de 10km/h por seguran√ßa)\n* ‚úî Central de atendimento 0800 24h\n* ‚úî Equipe de recupera√ß√£o de ve√≠culos pr√≥pria e integrada √† Pol√≠cia\n* ‚úî Cobertura de at√© 100% da Tabela FIPE em caso de roubo/furto n√£o recuperado\n4Ô∏è‚É£ Chamadas para A√ß√£o (CTAs) e Fechamento:\n\nPara engajar e qualificar:\n\"Gostaria de consultar um plano ideal para seu ve√≠culo? Me informe a placa que eu verifico para voc√™! üîç\"\n\"Podemos prosseguir com a contrata√ß√£o do rastreamento? Assim, j√° garantimos sua prote√ß√£o.\"\n\"Queremos deixar seu ve√≠culo seguro! Vamos seguir com a instala√ß√£o?\"\nSe o cliente quiser proposta formal:\n\"Posso te enviar a proposta por WhatsApp ou E-mail? Em breve, um consultor especializado entrar√° em contato para te explicar todos os detalhes!\"\nSe o cliente quiser comparar com concorrente:\n\"Entendo! Podemos te ajudar a comparar os benef√≠cios e vantagens do nosso servi√ßo com a proposta que recebeu. O que considera mais importante na sua escolha?\"\n5Ô∏è‚É£ Respostas Ajustadas para Situa√ß√µes Espec√≠ficas:\n\nCliente diz que vai pensar:\nü§ñ Z√© da Rota: \"Claro! Se precisar de mais informa√ß√µes, estou por aqui para te ajudar. Enquanto isso, posso te enviar um resumo dos planos para facilitar sua an√°lise?\"\nCliente solicita um or√ßamento em PDF:\nü§ñ Z√© da Rota: \"Sim, posso te enviar a proposta por WhatsApp ou E-mail. Qual a melhor forma para voc√™ receber?\"\nCliente menciona um concorrente (proposta mais barata):\nü§ñ Z√© da Rota: \"Entendo! Nossos planos incluem rastreamento e prote√ß√£o com equipe pr√≥pria de recupera√ß√£o e cobertura de at√© 100% da Tabela FIPE. Posso te ajudar a comparar as vantagens e ver como nosso custo-benef√≠cio √© superior?\"\nCliente pede instala√ß√£o fora das cidades atendidas:\nü§ñ Z√© da Rota: \"Atualmente, nossa instala√ß√£o padr√£o cobre Fortaleza e regi√£o metropolitana (Caucaia, Eus√©bio, Maracana√∫, Aquiraz, Itaitinga, Pacatuba e Maranguape). Mas, dependendo da sua localiza√ß√£o exata, podemos verificar uma possibilidade de instala√ß√£o para voc√™! Qual seria a cidade?\"\nCliente pergunta sobre bloqueio remoto:\nü§ñ Z√© da Rota: \"Sim, nosso sistema possui bloqueio remoto! Para sua seguran√ßa e a do ve√≠culo, o bloqueio √© efetivado quando o ve√≠culo est√° abaixo de 10km/h. Isso evita acidentes e garante uma parada segura. Quer saber mais sobre como essa funcionalidade te protege?\"\nCliente quer rastrear um ve√≠culo que n√£o √© dele:\nü§ñ Z√© da Rota: \"Sim, √© poss√≠vel! O plano pode ser contratado por qualquer pessoa, mesmo que o ve√≠culo n√£o esteja no seu nome. No entanto, √© importante saber que, em caso de sinistro (roubo ou furto n√£o recuperado), a indeniza√ß√£o ser√° paga ao propriet√°rio legal do ve√≠culo, conforme consta no documento, tudo bem?\"\nüì¢ Conclus√£o e Lembretes Finais:\n\n‚úÖ Prioridade M√°xima: Sempre consulte a Placa FIPE via n8n (ou pe√ßa modelo/ano) ANTES de oferecer planos.\n‚úÖ Foco no Cliente: Responda de forma clara, objetiva e sempre incentive o cliente a avan√ßar no funil de vendas.\n‚úÖ Proatividade: Utilize chamadas para a√ß√£o para aumentar as convers√µes.\n‚úÖ Precis√£o: Evite oferecer planos que n√£o se aplicam ao ve√≠culo consultado.\n‚úÖ Encaminhamento: Direcione clientes interessados e qualificados para um consultor humano para o fechamento quando o lead estiver maduro ou solicitar explicitamente.\nSeu objetivo √© ser o melhor especialista em prote√ß√£o veicular, ajudando cada cliente a encontrar a seguran√ßa que precisa com a CearaGPS!\""
        }
      },
      "id": "0f07f0e1-88e5-46b2-9bdd-f1899fbcbad1",
      "name": "Z√© da Rota",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        -1420,
        240
      ],
      "typeVersion": 1.8
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1w4W4qVK7g8mvdv3M14Gsq4StrBmCSA8FPe6B7sngMyc",
          "mode": "list",
          "cachedResultName": "NPS_TECNICO",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1w4W4qVK7g8mvdv3M14Gsq4StrBmCSA8FPe6B7sngMyc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "P√°gina1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1w4W4qVK7g8mvdv3M14Gsq4StrBmCSA8FPe6B7sngMyc/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Nota": "={{ $('Dados').item.json.Nota }}",
            "OS": "={{ $('Dados').item.json.os }}",
            "Nome": "={{ $('Dados').item.json['Nome '] }}"
          },
          "matchingColumns": [
            "Nota"
          ],
          "schema": [
            {
              "id": "OS",
              "displayName": "OS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Nome",
              "displayName": "Nome",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nota",
              "displayName": "Nota",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -760,
        -480
      ],
      "id": "a1895fe1-0a7f-4315-a452-27cb5fd54730",
      "name": "SAC",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Q0rDGbFqayibPO3n",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1w4W4qVK7g8mvdv3M14Gsq4StrBmCSA8FPe6B7sngMyc",
          "mode": "list",
          "cachedResultName": "NPS_TECNICO",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1w4W4qVK7g8mvdv3M14Gsq4StrBmCSA8FPe6B7sngMyc/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "P√°gina1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1w4W4qVK7g8mvdv3M14Gsq4StrBmCSA8FPe6B7sngMyc/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Nota": "={{ $('Dados').item.json.Nota }}",
            "OS": "={{ $('Dados').item.json.os }}",
            "Nome": "={{ $('Dados').item.json['Nome '] }}"
          },
          "matchingColumns": [
            "Nota"
          ],
          "schema": [
            {
              "id": "OS",
              "displayName": "OS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Nome",
              "displayName": "Nome",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nota",
              "displayName": "Nota",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -760,
        -220
      ],
      "id": "737dfcfa-15ab-450d-8477-cfb099fdda12",
      "name": "SAC1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Q0rDGbFqayibPO3n",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "connections": {
    "SerpAPI": {
      "ai_tool": [
        [
          {
            "node": "Z√© da Rota",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Z√© da Rota",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "If (Verifica Contato)": {
      "main": [
        [],
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If (Mensagem ou Nota)": {
      "main": [
        [
          {
            "node": "Dados",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Conversa",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Conversa": {
      "main": [
        [
          {
            "node": "Z√© da Rota",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verificar se o cliente esta no banco de dados": {
      "main": [
        [
          {
            "node": "Microsoft SQL1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If (Mensagem ou Nota)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Microsoft SQL1": {
      "main": [
        [
          {
            "node": "If (Mensagem ou Nota)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Microsoft SQL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF - Nota √ìtima (9-10)": {
      "main": [
        [
          {
            "node": "Evolution API8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF - Nota Ruim (1-4)": {
      "main": [
        [
          {
            "node": "Evolution API6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF - Nota M√©dia (5-8)": {
      "main": [
        [
          {
            "node": "Evolution API7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API8": {
      "main": [
        [
          {
            "node": "SAC1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API7": {
      "main": [
        [
          {
            "node": "SAC1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API6": {
      "main": [
        [
          {
            "node": "SAC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Microsoft SQL": {
      "main": [
        [
          {
            "node": "Verificar se o cliente esta no banco de dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dados": {
      "main": [
        [
          {
            "node": "IF - Nota √ìtima (9-10)",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF - Nota M√©dia (5-8)",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF - Nota Ruim (1-4)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "If (Verifica Contato)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "Z√© da Rota",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Eleven Labs1": {
      "main": [
        [
          {
            "node": "Extract from File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Evolution API2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Evolution API2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Eleven Labs1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Eleven Labs1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File1": {
      "main": [
        [
          {
            "node": "Evolution API3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "N√∫mero Aleat√≥rio1": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API2": {
      "main": [
        []
      ]
    },
    "Evolution API3": {
      "main": [
        []
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "N√∫mero Aleat√≥rio1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dividir saidas1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Z√© da Rota": {
      "main": [
        [
          {
            "node": "Dividir saidas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SAC": {
      "main": [
        [
          {
            "node": "Enviar email (nota baixa)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "236ea3e345741561adb33e8e53eda3f202d862bd9cf39f8f167fdd51eff339a0"
  }
}
